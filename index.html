<!DOCTYPE html>
<html lang="en">
    <head prefix="og: https://ogp.me/ns#">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css" />
    <title>Rhiannon Zine</title>

    <!-- social media preview -->
    <meta property="og:title" content="Rhiannon Zine" />
    <meta
      property="og:description"
      content="Online zine inspired by the Fleetwood Mac classic, Rhiannon"
    />
    <meta
      property="og:image"
      content="/assets/rhizine5.png"
    />
    <meta name="twitter:site" content="@saraharvy" />
    <meta
      name="twitter:card"
      content="summary || summary_large_image || player || app"
    />
    <meta name="twitter:creator" content="@saraharvy" />
  </head>

<body>

  <div class="container">
    
    <div class="overlay">
      <div class="big-name-graphic">Rhiannon</div>
      <div class="moon-animation"></div>
      <div class="stars-appear"><image src="assets/stars.png" width="100%"></div>
    </div>

    <header>
      <h1>Rhiannon</h1>
      
      <ul class="main-nav">
         <li><a href="about.html">About</a></li>
         <li><audio controls><source src='01Rhiannon.mp3' type="audio/mp3"></audio></li>
      </ul>
    </header>

      <div class="carousel">
        <div class="nav nav-left">
          <div class="ion-chevron-left carousel-arrow-icon-left"></div>
        </div>

          <div class="carousel-content">
            
            <div class="slide slide-1">
              <div><image src="assets/rhizine1.png" width="100%"></div>
                <div style="width:95%">
                  <p>Rhiannon rings like a bell through
                  the night, and wouldn't you love
                  to love her?
                  Takes to the sky like a bird in flight,
                  and who will be her lover?</p>
                </div>
            </div>

            <div class="slide slide-2">
              <div><image src="assets/rhizine2.png" width="100%"></div>
                <div style="width:95%">
                  <p>All your life you've never seen a woman
                  taken by the wind. Would you stay if she
                promised you heaven? Will you ever win? Will you ever win?</p>
                </div>
            </div>

            <div class="slide slide-3">
              <div><image src="assets/rhizine3.png" width="100%"></div>           
                <div style="width:95%">
                  <p>She is like a cat in the dark and then she is
                  the darkness. She rules her life like a fine skylark,
                and when the sky is starless</p>
                </div>
            </div>
            
            <div class="slide slide-4">
              <div><image src="assets/rhizine4.png" width="100%"></div>
                <div style="width:95%">
                  <p>All your life you've never seen a woman taken by
                  the wind. Would you stay if she promised you heaven?
                Will you ever win? Will you ever win?</p>
                </div>
            </div>

            <div class="slide slide-5">
              <div><image src="assets/rhizine5.png" width="100%"></div>
                <div style="width:95%">
                  <p>She rings like a bell through the night, and 
                  wouldn't you love to love her? Takes to the sky like
                a bird in flight, and who will be her lover?</p>
                </div>
            </div>

            <div class="slide slide-6">
              <div><image src="assets/rhizine6.png" width="100%"></div>
                <div style="width:95%">
                  <p>All your life you've never seen a woman taken by
                  the wind. Would you stay if she promised you heaven?
                Will you ever win? Rhiannon</p>
                </div>
            </div>

            <div class="slide slide-7">
              <div><image src="assets/rhizine7.png" width="100%"></div>
                <div style="width:95%">
                  <p>Taken by,</p>
                  <p>taken by the wind.</p>
                  <p>Dreams unwind,</p>
                  <p>love's a state of mind.</p>
                  <p>&#8212Stevie Nicks, Fleetwood Mac</p>
                </div>
            </div>

            <div class="slide slide-8">
              <div><image src="assets/rhizine8.png" width="100%"></div>
                <div style="width:95%">
                  <p>Art by Sara Harvey &copy;2020</p>
                  <p>IG <a href="https://www.instagram.com/ambivalent_sun/" target="_blank">&#64;ambivalent_sun</a></p>
                  <p><a href="http://saraharvey.xyz/" target="_blank">saraharvey.xyz</a></p>
                  <p>Open-souce fonts: <a href="http://velvetyne.fr/fonts/trickster/" target="_blank">Trickster</a>, <a href="https://www.pepite-collectif.com/portfolio/moche/" target="_blank">Moche</a></p>
                </div>
            </div>

          </div>

        <div class="nav nav-right">
          <div class="ion-chevron-right carousel-arrow-icon-right"></div>
        </div>
      </div>
      
  </div>

  <script>
    var carousel = document.querySelector('.carousel');
    var carouselContent = document.querySelector('.carousel-content');
    var slides = document.querySelectorAll('.slide');
    var arrayOfSlides = Array.prototype.slice.call(slides);
    var carouselDisplaying;
    var screenSize;
    setScreenSize();
    var lengthOfSlide;

    function addClone() {
       var lastSlide = carouselContent.lastElementChild.cloneNode(true);
       lastSlide.style.left = (-lengthOfSlide) + "px";
       carouselContent.insertBefore(lastSlide, carouselContent.firstChild);
    }
    // addClone();

    function removeClone() {
      var firstSlide = carouselContent.firstElementChild;
      firstSlide.parentNode.removeChild(firstSlide);
    }

    function moveSlidesRight() {
      var slides = document.querySelectorAll('.slide');
      var slidesArray = Array.prototype.slice.call(slides);
      var width = 0;

      slidesArray.forEach(function(el, i){
        el.style.left = width + "px";
        width += lengthOfSlide;
      });
      addClone();
    }
    moveSlidesRight();

    function moveSlidesLeft() {
      var slides = document.querySelectorAll('.slide');
      var slidesArray = Array.prototype.slice.call(slides);
      slidesArray = slidesArray.reverse();
      var maxWidth = (slidesArray.length - 1) * lengthOfSlide;

      slidesArray.forEach(function(el, i){
        maxWidth -= lengthOfSlide;
        el.style.left = maxWidth + "px";
      });
    }

    window.addEventListener('resize', setScreenSize);

    function setScreenSize() {
      if ( window.innerWidth >= 500 ) {
        carouselDisplaying = 3;
      } else if ( window.innerWidth >= 300 ) {
        carouselDisplaying = 1;
      } else {
        carouselDisplaying = 1;
      }
      getScreenSize();
    }

    function getScreenSize() {
      var slides = document.querySelectorAll('.slide');
      var slidesArray = Array.prototype.slice.call(slides);
      lengthOfSlide = ( carousel.offsetWidth  / carouselDisplaying );
      var initialWidth = -lengthOfSlide;
      slidesArray.forEach(function(el) {
        el.style.width = lengthOfSlide + "px";
        el.style.left = initialWidth + "px";
        initialWidth += lengthOfSlide;
      });
    }


    var rightNav = document.querySelector('.nav-right');
    rightNav.addEventListener('click', moveLeft);

    var moving = true;
    function moveRight() {
      if ( moving ) {
        moving = false;
        var lastSlide = carouselContent.lastElementChild;
        lastSlide.parentNode.removeChild(lastSlide);
        carouselContent.insertBefore(lastSlide, carouselContent.firstChild);
        removeClone();
        var firstSlide = carouselContent.firstElementChild;
        firstSlide.addEventListener('transitionend', activateAgain);
        moveSlidesRight();
      }
    }

    function activateAgain() {
      var firstSlide = carouselContent.firstElementChild;
      moving = true;
      firstSlide.removeEventListener('transitionend', activateAgain);
    }

    var leftNav = document.querySelector('.nav-left');
    leftNav.addEventListener('click', moveRight);

    // var moveLeftAgain = true;

    function moveLeft() {
      if ( moving ) {
        moving = false;
        removeClone();
        var firstSlide = carouselContent.firstElementChild;
        firstSlide.addEventListener('transitionend', replaceToEnd);
        moveSlidesLeft();
      }
    }

    function replaceToEnd() {
      var firstSlide = carouselContent.firstElementChild;
      firstSlide.parentNode.removeChild(firstSlide);
      carouselContent.appendChild(firstSlide);
      firstSlide.style.left = ( (arrayOfSlides.length -1) * lengthOfSlide) + "px";
      addClone();
      moving = true;
      firstSlide.removeEventListener('transitionend', replaceToEnd);
    }


    carouselContent.addEventListener('mousedown', seeMovement);

    var initialX;
    var initialPos;
    function seeMovement(e) {
      initialX = e.clientX;
      getInitialPos();
      carouselContent.addEventListener('mousemove', slightMove);
      document.addEventListener('mouseup', moveBasedOnMouse);
    }

    function slightMove(e) {
      if ( moving ) {
        var movingX = e.clientX;
        var difference = initialX - movingX;
        if ( Math.abs(difference) < (lengthOfSlide/4) ) {
          slightMoveSlides(difference);
        }  
      }
    }

    function getInitialPos() {
      var slides = document.querySelectorAll('.slide');
      var slidesArray = Array.prototype.slice.call(slides);
      initialPos = [];
      slidesArray.forEach(function(el){
        var left = Math.floor( parseInt( el.style.left.slice(0, -2 ) ) ); 
        initialPos.push( left );
      });
    }

    function slightMoveSlides(newX) {
      var slides = document.querySelectorAll('.slide');
      var slidesArray = Array.prototype.slice.call(slides);
      slidesArray.forEach(function(el, i){
        var oldLeft = initialPos[i];
        el.style.left = (oldLeft + newX) + "px";
      });
    }

    function moveBasedOnMouse(e) { 
      var finalX = e.clientX;
      if ( initialX - finalX > 0) {
        moveRight();
      } else if ( initialX - finalX < 0 ) {
        moveLeft();
      }
      document.removeEventListener('mouseup', moveBasedOnMouse);
      carouselContent.removeEventListener('mousemove', slightMove);
    }
  </script>


</body>
</html>
